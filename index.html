<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CELCAT Calendar</title>
    <style>
        :root {
            --ut3-green: #1d3d2e;
            --sidebar-bg: #f0f4f2;
            --border-dark: #d1d1d1;
            --cours-blue: #7d8cf4;
            --td-red: #f88c8c;
            --tp-teal: #64b4a1;
            --text-main: #333333;
            --header-height: 50px;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: var(--text-main);
            overflow: hidden;
        }

        header {
            background-color: var(--ut3-green);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            height: var(--header-height);
            z-index: 200;
        }

        .logo-area { font-weight: bold; font-size: 18px; margin-right: 30px; }
        nav { display: flex; align-items: center; height: 100%; }
        nav span { margin: 0 15px; cursor: pointer; opacity: 0.9; display: flex; align-items: center; height: 100%; }
        .user-info { margin-left: auto; font-size: 12px; display: flex; align-items: center; gap: 8px; }

        .layout { display: flex; flex: 1; overflow: hidden; position: relative; }

        aside {
            width: 280px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-dark);
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        .sidebar-title { background: #e2e8e5; padding: 12px 15px; font-weight: bold; font-size: 16px; border-bottom: 1px solid var(--border-dark); }
        .sidebar-content { padding: 15px; font-size: 14px; border-bottom: 1px solid var(--border-dark); }
        .mini-calendar { margin-top: 10px; border: 1px solid #ccc; background: white; text-align: center; width: 60px; border-radius: 3px; overflow: hidden; }

        .editor-drawer {
            position: fixed;
            left: -305px;
            top: var(--header-height);
            bottom: 0;
            width: 300px;
            background: white;
            border-right: 3px solid var(--ut3-green);
            z-index: 150; 
            transition: left 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 10px 0 20px rgba(0,0,0,0.3);
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .editor-drawer.open { left: 0; }

        .tab-trigger {
            position: absolute;
            right: -42px;
            bottom: 40px; 
            width: 42px;
            height: 50px;
            background: var(--ut3-green);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 0 5px 5px 0;
            font-size: 22px;
            box-shadow: 4px 0 8px rgba(0,0,0,0.1);
        }

        .admin-panel h4 { margin: 0 0 15px 0; color: var(--ut3-green); text-transform: uppercase; font-size: 12px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        input, select, button { width: 100%; margin-bottom: 12px; font-size: 13px; padding: 10px; border: 1px solid #ccc; border-radius: 3px; box-sizing: border-box; }
        .btn-valider { background: #f5f5f5; font-weight: bold; cursor: pointer; border: 1px solid #bbb; }
        .btn-pdf { background: #333; color: white; cursor: pointer; font-weight: bold; border: none; }

        .calendar-container { flex: 1; display: flex; flex-direction: column; background: white; }
        .calendar-top-bar { padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border-dark); background: #fcfcfc; }
        .current-date-display { font-size: 18px; font-weight: bold; display: flex; align-items: center; gap: 6px; }

        .grid-wrapper { flex: 1; overflow-y: auto; display: grid; grid-template-columns: 60px repeat(7, 1fr); grid-template-rows: 35px repeat(28, 35px); position: relative; }
        .grid-header { background: #fcfcfc; border: 0.5px solid var(--border-dark); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; color: #1d3d2e; position: sticky; top: 0; z-index: 20; }
        .time-label { grid-column: 1; border: 0.5px solid #efefef; font-size: 10px; text-align: center; padding-top: 6px; background: #f9f9f9; }

        /* --- STYLE DES COURS MIS √Ä JOUR (IMAGE 8beede) --- */
        .course-box { 
            margin: 1px 2px; 
            padding: 5px; 
            font-size: 10px; 
            color: #000; 
            border: 1px solid rgba(0,0,0,0.4); 
            position: relative; 
            z-index: 5; 
            line-height: 1.2;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .course-box.cours { background-color: var(--cours-blue); }
        .course-box.td { background-color: var(--td-red); }
        .course-box.tp { background-color: var(--tp-teal); }
        
        .course-box .time-info { font-size: 10px; margin-bottom: 2px; }
        .course-box .type-info { font-weight: bold; margin-bottom: 1px; }
        .course-box .title-info { margin-bottom: 1px; }
        .course-box .room-info { margin-bottom: 1px; }
        .course-box .group-info { font-size: 9px; }

        .del-btn { position: absolute; bottom: 3px; right: 3px; background: rgba(255,255,255,0.5); border: 1px solid rgba(0,0,0,0.1); cursor: pointer; font-size: 11px; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border-radius: 2px; opacity: 0; transition: opacity 0.2s; }
        .course-box:hover .del-btn { opacity: 1; }

        @media print { .editor-drawer, .tab-trigger, header { display: none !important; } }
    </style>
</head>
<body>

<header>
    <div class="logo-area">Universit√© de Toulouse</div>
    <nav>
        <span>Accueil</span><span>S√©lecteur de dates</span><span>Filtre d'√©v√©nements</span><span>Partager</span><span>Aide</span>
    </nav>
    <div class="user-info" id="topUserInfo">üë§ D√©connexion - [NUMERO]</div>
</header>

<div class="layout">
    <div class="editor-drawer" id="drawer">
        <div class="tab-trigger" onclick="toggleDrawer()" title="√âditeur de planning">‚öôÔ∏è</div>
        <div class="admin-panel">
            <h4>√âditeur de Planning</h4>
            <input type="text" id="cName" placeholder="Nom du cours (ex: Algorithmique 1)">
            <input type="text" id="cRoom" placeholder="Salle (ex: U3-103)">
            <input type="text" id="cGroup" placeholder="Code groupe (ex: INXPA11B1)">
            <select id="cDay">
                <option value="2">Lundi</option><option value="3">Mardi</option>
                <option value="4">Mercredi</option><option value="5">Jeudi</option>
                <option value="6">Vendredi</option><option value="7">Samedi</option>
                <option value="8">Dimanche</option>
            </select>
            <select id="cStartH"></select>
            <select id="cDur">
                <option value="2">1h00</option><option value="3">1h30</option><option value="4">2h00</option><option value="6">3h00</option>
            </select>
            <select id="cType">
                <option value="Cours">Cours</option><option value="TD">TD</option><option value="TP">TP</option>
            </select>
            <button class="btn-valider" onclick="addCourse()">Valider</button>
            <button class="btn-pdf" onclick="window.print()">T√©l√©charger PDF</button>
            <button style="border:none; background:none; text-decoration:underline; font-size:10px; cursor:pointer; color: #666;" onclick="resetIdentity()">Changer d'identit√©</button>
        </div>
    </div>

    <aside>
        <div class="sidebar-title">√âv√©nement</div>
        <div class="sidebar-content" style="color:#999; font-style: italic;">(aucun s√©lectionn√©)</div>
        <div class="sidebar-title">√âtudiant</div>
        <div class="sidebar-content">
            <strong id="sideUserName" style="font-size: 15px;">Chargement...</strong><br>
            D√©partement: FSI / Licence<br>
            <div class="mini-calendar" id="miniCal"></div>
        </div>
    </aside>

    <div class="calendar-container">
        <div class="calendar-top-bar">
            <div style="display:flex; gap:8px;">
                <button style="background:#f9f9f9; border:1px solid #ccc; padding:5px 10px; font-size:12px; cursor:pointer; border-radius:3px;">Aujourd'hui</button>
                <button style="background:#f9f9f9; border:1px solid #ccc; padding:5px 10px; font-size:12px; cursor:pointer; border-radius:3px;">&lt;</button>
                <button style="background:#f9f9f9; border:1px solid #ccc; padding:5px 10px; font-size:12px; cursor:pointer; border-radius:3px;">&gt;</button>
            </div>
            <div class="current-date-display"><span id="dateDisplay"></span> üìÖ</div>
            <div style="display:flex; border:1px solid #ccc; border-radius:3px; overflow:hidden;">
                <button style="background:#f9f9f9; border:none; border-right:1px solid #ccc; padding:5px 12px; font-size:12px; cursor:pointer;">Mois</button>
                <button style="background:#dcdcdc; border:none; border-right:1px solid #ccc; padding:5px 12px; font-size:12px; cursor:pointer; font-weight:bold;">Semaine</button>
                <button style="background:#f9f9f9; border:none; padding:5px 12px; font-size:12px; cursor:pointer;">Jour</button>
            </div>
        </div>

        <div class="grid-wrapper" id="grid">
            <div class="grid-header"></div>
            <div class="grid-header">lun. <span id="d1"></span></div>
            <div class="grid-header">mar. <span id="d2"></span></div>
            <div class="grid-header">mer. <span id="d3"></span></div>
            <div class="grid-header">jeu. <span id="d4"></span></div>
            <div class="grid-header">ven. <span id="d5"></span></div>
            <div class="grid-header">sam. <span id="d6"></span></div>
            <div class="grid-header">dim. <span id="d7"></span></div>
        </div>
    </div>
</div>

<script>
    const grid = document.getElementById('grid');
    const drawer = document.getElementById('drawer');
    const startH = document.getElementById('cStartH');
    let courses = JSON.parse(localStorage.getItem('celcat_replica_final')) || [];

    function toggleDrawer() { drawer.classList.toggle('open'); }

    function checkIdentity() {
        let name = localStorage.getItem('studentName'), number = localStorage.getItem('studentNumber');
        if (!name || !number) {
            name = prompt("Pr√©nom et NOM :"); number = prompt("Num√©ro √âtudiant :");
            localStorage.setItem('studentName', (name || "UTILISATEUR").toUpperCase());
            localStorage.setItem('studentNumber', number || "00000000");
        }
        document.getElementById('topUserInfo').innerText = `üë§ D√©connexion - ${localStorage.getItem('studentNumber')}`;
        document.getElementById('sideUserName').innerText = `${localStorage.getItem('studentName')} (${localStorage.getItem('studentNumber')})`;
    }

    function resetIdentity() { localStorage.clear(); location.reload(); }

    function updateDates() {
        const today = new Date();
        const monday = new Date(today.setDate(today.getDate() - today.getDay() + (today.getDay() === 0 ? -6 : 1)));
        const sunday = new Date(new Date(monday).setDate(monday.getDate() + 6));
        document.getElementById('dateDisplay').innerText = `${monday.getDate()} ‚Äì ${sunday.toLocaleDateString('fr-FR', {day:'numeric', month:'short'})} 2026`;
        for(let i=0; i<7; i++) {
            let d = new Date(new Date(monday).setDate(monday.getDate() + i));
            document.getElementById(`d${i+1}`).innerText = `${d.getDate()}/${d.getMonth()+1}`;
        }
        document.getElementById('miniCal').innerHTML = `<div style="background:#cc0000; color:white; font-size:10px; font-weight:bold; padding:2px;">${new Intl.DateTimeFormat('fr-FR', {month:'short'}).format(new Date()).toUpperCase()}</div><div style="font-size:18px; font-weight:bold; padding:4px;">${new Date().getDate()}</div>`;
    }

    // Convertit l'index de ligne en format HH:MM
    function rowToTime(row) {
        let totalMinutes = (row - 2) * 30 + (7 * 60);
        let h = Math.floor(totalMinutes / 60);
        let m = totalMinutes % 60;
        return (h < 10 ? '0'+h : h) + ':' + (m === 0 ? '00' : m);
    }

    function init() {
        checkIdentity(); updateDates();
        for (let h = 7; h < 21; h++) {
            for (let m of ['00', '30']) {
                const o = document.createElement('option');
                o.value = (h-7)*2 + (m === '30' ? 3 : 2); o.innerText = h + ':' + m;
                startH.appendChild(o);
                const l = document.createElement('div');
                l.className = 'time-label'; l.style.gridRow = o.value; l.innerText = m === '00' ? h + ':00' : '';
                grid.appendChild(l);
            }
        }
        render();
    }

    function addCourse() {
        const startRow = parseInt(document.getElementById('cStartH').value);
        const duration = parseInt(document.getElementById('cDur').value);
        const endRow = startRow + duration;

        courses.push({ 
            id: Date.now(), 
            name: document.getElementById('cName').value || 'Mati√®re', 
            room: document.getElementById('cRoom').value || 'Salle', 
            group: document.getElementById('cGroup').value || 'Groupe',
            day: document.getElementById('cDay').value, 
            start: startRow,
            startTime: rowToTime(startRow),
            endTime: rowToTime(endRow),
            dur: duration, 
            type: document.getElementById('cType').value 
        });
        localStorage.setItem('celcat_replica_final', JSON.stringify(courses)); 
        render();
    }

    function render() {
        document.querySelectorAll('.course-box').forEach(b => b.remove());
        courses.forEach(c => {
            const b = document.createElement('div');
            // Utilisation du type pour la couleur (minuscule pour le CSS)
            b.className = `course-box ${c.type.toLowerCase()}`;
            b.style.gridColumn = c.day; b.style.gridRow = `${c.start} / span ${c.dur}`;
            
            // Structure identique √† l'image 8beede
            b.innerHTML = `
                <div class="time-info">${c.startTime} - ${c.endTime}</div>
                <div class="type-info">${c.type}</div>
                <div class="title-info">KINXPA11 - ${c.name}</div>
                <div class="room-info">FSI / ${c.room}</div>
                <div class="group-info">${c.group}</div>
                <button class="del-btn" onclick="event.stopPropagation(); del(${c.id})">√ó</button>
            `;
            grid.appendChild(b);
        });
    }

    function del(id) { courses = courses.filter(x => x.id !== id); localStorage.setItem('celcat_replica_final', JSON.stringify(courses)); render(); }

    init();
</script>
</body>
</html>
