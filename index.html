<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CELCAT Calendar - Université de Toulouse</title>
    <style>
        :root {
            --ut3-green: #1d3d2e;
            --sidebar-bg: #f0f4f2;
            --border-color: #d1d1d1;
            --text-dark: #333;
            --cours-blue: #7d8cf4;
            --td-red: #f88c8c;
            --tp-teal: #64b4a1;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: var(--text-dark);
            overflow: hidden;
        }

        /* HEADER */
        header {
            background-color: var(--ut3-green);
            color: white;
            display: flex;
            align-items: center;
            padding: 5px 20px;
            font-size: 13px;
            height: 40px;
        }

        .logo-area { font-weight: bold; font-size: 16px; margin-right: 30px; }
        nav span { margin: 0 10px; cursor: pointer; opacity: 0.8; }
        
        .layout { display: flex; flex: 1; overflow: hidden; }

        /* SIDEBAR */
        aside {
            width: 240px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-section { border-bottom: 1px solid var(--border-color); }
        .sidebar-title { 
            background: #e2e8e5; 
            padding: 6px 10px; 
            font-weight: bold; 
            font-size: 12px; 
            border-bottom: 1px solid var(--border-color);
        }
        .sidebar-content { padding: 8px 10px; font-size: 11px; }

        .mini-calendar {
            background: white;
            margin: 5px;
            border: 1px solid #ccc;
            text-align: center;
            padding: 5px;
            border-radius: 4px;
        }

        /* PANEL EDITION */
        .admin-panel { padding: 10px; background: #fff; border-top: 2px solid var(--ut3-green); margin-top: auto; }
        .admin-panel h4 { margin: 0 0 10px 0; font-size: 12px; color: var(--ut3-green); }
        input, select, button { width: 100%; margin-bottom: 6px; font-size: 11px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; box-sizing: border-box; }
        button { background: var(--ut3-green); color: white; font-weight: bold; cursor: pointer; border: none; }

        /* ZONE CALENDRIER MAIN */
        .calendar-container { flex: 1; display: flex; flex-direction: column; background: white; }

        /* BARRE DE NAVIGATION SEMAINE (CENTRÉE) */
        .calendar-top-bar {
            padding: 10px;
            display: grid;
            grid-template-columns: 1fr auto 1fr; /* Structure en 3 colonnes pour centrer parfaitement */
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .nav-arrows { display: flex; gap: 5px; }
        .current-date-display { font-size: 18px; font-weight: bold; text-align: center; }
        .view-options { display: flex; justify-content: flex-end; }

        .btn-view { padding: 4px 10px; font-size: 11px; border: 1px solid #ccc; background: #f9f9f9; cursor: pointer; }
        .btn-active { background: #e2e2e2; font-weight: bold; }

        /* LA GRILLE */
        .grid-wrapper { flex: 1; overflow-y: auto; display: grid; grid-template-columns: 60px repeat(5, 1fr); grid-template-rows: 35px repeat(28, 30px); position: relative; }
        
        .grid-header { 
            background: #f8f8f8; border: 0.5px solid var(--border-color); 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 12px; color: #1d3d2e;
            position: sticky; top: 0; z-index: 20;
        }

        .time-label { grid-column: 1; border: 0.5px solid #eee; font-size: 10px; color: #888; text-align: center; padding-top: 5px; }

        /* CARTES DE COURS */
        .course-box {
            margin: 2px; padding: 6px; font-size: 10px; color: black; border-radius: 2px;
            border: 1px solid rgba(0,0,0,0.1); position: relative; z-index: 5; line-height: 1.3;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        .course-box.cours { background: var(--cours-blue); }
        .course-box.td { background: var(--td-red); }
        .course-box.tp { background: var(--tp-teal); }
        
        .del-btn { position: absolute; top: 0; right: 0; background: rgba(0,0,0,0.1); border: none; font-size: 9px; cursor: pointer; color: white; }
    </style>
</head>
<body>

<header>
    <div class="logo-area">Université de Toulouse</div>
    <nav>
        <span>Accueil</span> | <span>Sélecteur de dates</span> | <span>Filtre d'événements</span> | <span>Partager</span> | <span>Aide</span>
    </nav>
    <div style="margin-left: auto;">Déconnexion - 22506567</div>
</header>

<div class="layout">
    <aside>
        <div class="sidebar-section">
            <div class="sidebar-title">Événement</div>
            <div class="sidebar-content" style="color:#999;">(aucun sélectionné)</div>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Étudiant</div>
            <div class="sidebar-content">
                <strong>BONPART NIELS (22506567)</strong><br>
                Département: FSI / Licence<br>
                <div class="mini-calendar" id="miniCal"></div>
            </div>
        </div>
        
        <div class="admin-panel">
            <h4>Éditeur de Façade</h4>
            <input type="text" id="name" placeholder="Matière">
            <input type="text" id="room" placeholder="Salle / Bâtiment">
            <select id="day">
                <option value="2">Lundi</option>
                <option value="3">Mardi</option>
                <option value="4">Mercredi</option>
                <option value="5">Jeudi</option>
                <option value="6">Vendredi</option>
            </select>
            <select id="startH"></select>
            <select id="dur">
                <option value="3">1h30</option>
                <option value="4">2h00</option>
                <option value="6">3h00</option>
            </select>
            <select id="type">
                <option value="cours">Cours</option>
                <option value="td">TD</option>
                <option value="tp">TP</option>
            </select>
            <button onclick="addCourse()">+ Ajouter au Calendrier</button>
        </div>
    </aside>

    <div class="calendar-container">
        <div class="calendar-top-bar">
            <div class="nav-arrows">
                <button class="btn-view" style="font-weight:bold;">Aujourd'hui</button>
                <button class="btn-view">&lt;</button>
                <button class="btn-view">&gt;</button>
            </div>

            <div class="current-date-display" id="dateDisplay"></div>

            <div class="view-options">
                <button class="btn-view">Mois</button>
                <button class="btn-view btn-active">Semaine</button>
                <button class="btn-view">Jour</button>
                <button class="btn-view">Mon planning</button>
            </div>
        </div>

        <div class="grid-wrapper" id="grid">
            <div class="grid-header"></div>
            <div class="grid-header">lun. <span id="d1"></span></div>
            <div class="grid-header">mar. <span id="d2"></span></div>
            <div class="grid-header">mer. <span id="d3"></span></div>
            <div class="grid-header">jeu. <span id="d4"></span></div>
            <div class="grid-header">ven. <span id="d5"></span></div>
        </div>
    </div>
</div>

<script>
    const grid = document.getElementById('grid');
    const startH = document.getElementById('startH');
    let courses = JSON.parse(localStorage.getItem('celcat_vfinal')) || [];

    // --- LOGIQUE DE DATE AUTOMATIQUE ---
    function updateDates() {
        const today = new Date();
        const dayOfWeek = today.getDay(); 
        const diffToMonday = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
        
        const monday = new Date(today.setDate(diffToMonday));
        const sunday = new Date(new Date(monday).setDate(monday.getDate() + 6));

        const options = { day: 'numeric', month: 'short' };
        const year = monday.getFullYear();

        // Affichage centré
        document.getElementById('dateDisplay').innerText = 
            `${monday.getDate()} – ${sunday.toLocaleDateString('fr-FR', options)} ${year}`;

        for(let i=0; i<5; i++) {
            let d = new Date(new Date(monday).setDate(monday.getDate() + i));
            document.getElementById(`d${i+1}`).innerText = `${d.getDate()}/${d.getMonth()+1}`;
        }
        
        document.getElementById('miniCal').innerHTML = `
            <div style="background:#cc0000; color:white; font-size:9px; font-weight:bold; text-transform:uppercase; padding:2px;">
                ${new Intl.DateTimeFormat('fr-FR', {month: 'long'}).format(new Date())}
            </div>
            <div style="font-size:16px; font-weight:bold; padding:5px;">${new Date().getDate()}</div>
        `;
    }

    function init() {
        let row = 2;
        for (let h = 7; h < 21; h++) {
            for (let m of ['00', '30']) {
                const l = document.createElement('div');
                l.className = 'time-label';
                l.style.gridRow = row;
                l.innerText = m === '00' ? h + ':00' : '';
                grid.appendChild(l);

                const o = document.createElement('option');
                o.value = row;
                o.innerText = h + ':' + m;
                startH.appendChild(o);
                row++;
            }
        }
        updateDates();
        render();
    }

    function addCourse() {
        const c = {
            id: Date.now(),
            name: document.getElementById('name').value || 'Matière',
            room: document.getElementById('room').value || 'Amphi',
            day: document.getElementById('day').value,
            start: document.getElementById('startH').value,
            dur: document.getElementById('dur').value,
            type: document.getElementById('type').value
        };
        courses.push(c);
        localStorage.setItem('celcat_vfinal', JSON.stringify(courses));
        render();
    }

    function render() {
        document.querySelectorAll('.course-box').forEach(b => b.remove());
        courses.forEach(c => {
            const b = document.createElement('div');
            b.className = `course-box ${c.type}`;
            b.style.gridColumn = c.day;
            b.style.gridRow = `${c.start} / span ${c.dur}`;
            b.innerHTML = `
                <button class="del-btn" onclick="del(${c.id})">×</button>
                <strong>${c.name}</strong>
                ${c.room}<br>
                FSI / UT3
            `;
            grid.appendChild(b);
        });
    }

    function del(id) {
        courses = courses.filter(x => x.id !== id);
        localStorage.setItem('celcat_vfinal', JSON.stringify(courses));
        render();
    }

    init();
</script>
</body>
</html>
